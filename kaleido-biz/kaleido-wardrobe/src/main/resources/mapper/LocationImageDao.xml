<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xiaoo.kaleido.wardrobe.infrastructure.dao.LocationImageDao">

    <resultMap id="BaseResultMap" type="com.xiaoo.kaleido.wardrobe.infrastructure.dao.po.LocationImagePO">
        <id column="id" property="id"/>

        <result column="location_id" property="locationId"/>
        <result column="path" property="path"/>
        <result column="image_order" property="imageOrder"/>
        <result column="is_primary" property="isPrimary"/>
        <result column="image_size" property="imageSize"/>
        <result column="image_type" property="imageType"/>
        <result column="width" property="width"/>
        <result column="height" property="height"/>
    </resultMap>

    <sql id="Base_Column_List">
        id, location_id, path, image_order, is_primary, image_size, image_type, width, height
    </sql>

    <select id="findByLocationId" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM t_wardrobe_location_image
        WHERE location_id = #{locationId} AND deleted = 0
        ORDER BY image_order ASC
    </select>

    <select id="findByLocationIds" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM t_wardrobe_location_image
        WHERE location_id IN
        <foreach collection="locationIds" item="locationId" open="(" separator="," close=")">
            #{locationId}
        </foreach>
        AND deleted = 0
        ORDER BY location_id, image_order ASC
    </select>

    <insert id="batchInsert" parameterType="java.util.List">
        INSERT INTO t_wardrobe_location_image (
            id, created_at, updated_at, deleted, lock_version,
            location_id, path, image_order, is_primary, image_size, image_type, width, height
        ) VALUES
        <foreach collection="list" item="item" separator=",">
            (
            #{item.id}, #{item.createdAt}, #{item.updatedAt}, #{item.deleted}, #{item.lockVersion},
            #{item.locationId}, #{item.path}, #{item.imageOrder}, #{item.isPrimary},
            #{item.imageSize}, #{item.imageType}, #{item.width}, #{item.height}
            )
        </foreach>
    </insert>

    <update id="deleteByLocationId">
        UPDATE t_wardrobe_location_image
        SET deleted = 1, updated_at = NOW()
        WHERE location_id = #{locationId} AND deleted = 0
    </update>

</mapper>
